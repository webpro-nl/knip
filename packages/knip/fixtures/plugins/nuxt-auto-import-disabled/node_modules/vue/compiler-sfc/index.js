const scriptRe = /<script(\b[^>]*)>([\s\S]*?)<\/script>/g;
const templateRe = /<template(\b[^>]*)>([\s\S]*?)<\/template>/g;

function parse(source) {
  let script = null;
  let scriptSetup = null;
  let template = null;

  let m;
  while ((m = scriptRe.exec(source))) {
    const attrs = m[1];
    const content = m[2];
    if (attrs.includes('setup')) {
      scriptSetup = { content };
    } else {
      script = { content };
    }
  }
  scriptRe.lastIndex = 0;

  m = templateRe.exec(source);
  if (m) {
    const content = m[2];
    const children = [];
    const tagRe = /<([A-Za-z][A-Za-z0-9-]*)/g;
    let tm;
    while ((tm = tagRe.exec(content))) children.push({ tag: tm[1], children: [], props: [] });
    template = { content, ast: { children } };
  }
  templateRe.lastIndex = 0;

  return { descriptor: { script, scriptSetup, template, styles: [], customBlocks: [] } };
}

module.exports = { parse };
